<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.itwillbs.mappers.ProjectMapper">

	<select id="getProjectCount" resultType="java.lang.Integer">
		select count(*) from project
	</select>
	
	<select id="getProjectMaxNum" resultType="java.lang.Integer">
		select max(p_num) from project
	</select>

	<!-- limit 시작행-1,개수 -->
	<select id="getProjectBoardList" resultType="com.itwillbs.domain.ProjectDTO">
		select p.*, m.name, m.matching from project p join member m
		on p.id = m.id
		<if test="search != null">
			<if test="select == 'p_title'">
			where p_title like CONCAT('%',#{search},'%')
			</if>
			<if test="select == 'p_content'">
			where p_content like CONCAT('%',#{search},'%')
			</if>
			<if test="select == 'name123'">
			where m.name like CONCAT('%',#{search},'%') 
			</if>
		</if>
		order by p.p_num desc
		limit #{startRow},#{pageSize}
	</select>
	
	<select id="getProjectBoardCount" resultType="java.lang.Integer">
		select count(p.p_num) from project p join member m
		on p.id = m.id
		<if test="search != null">
			<if test="select == 'p_title'">
			where p_title like CONCAT('%',#{search},'%')
			</if>
			<if test="select == 'p_content'">
			where p_content like CONCAT('%',#{search},'%')
			</if>
			<if test="select == 'name123'">
			where m.name like CONCAT('%',#{search},'%') 
			</if>
		</if>
	</select>
	
	<select id="getProjectBoard" resultType="com.itwillbs.domain.ProjectDTO">
		select * from project
		where p_num = #{p_num}
	</select>
	
	<update id="updateProjectReadcount">
		update project
		set p_readcount = p_readcount + 1
		where p_num = #{p_num}
	</update>
	
	
</mapper>